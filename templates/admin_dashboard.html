{% extends "base.html" %}
{% block title %}Admin Dashboard - Der Dümmste fliegt{% endblock %}

{% block content %}
<h2>Admin Dashboard</h2>
<p>Aktuelle Runde: <span id="current-round">{{ current_round_name }}</span></p>
<div class="mb-3">
    <a href="{{ url_for('add_player') }}" class="btn btn-primary">Spieler hinzufügen</a>
    <a href="{{ url_for('reset_votes') }}" class="btn btn-warning">Stimmen zurücksetzen</a>
    <a href="{{ url_for('rounds.add_round') }}" class="btn btn-success">Neue Runde starten</a>
    <a href="{{ url_for('admin_logout') }}" class="btn btn-danger">Logout</a>
</div>
<table class="table table-bordered" id="participants-table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Stimmen</th>
        </tr>
    </thead>
    <tbody id="participants-body">
        {% for participant in participants %}
        <tr>
            <td>{{ participant.name }}</td>
            <td>{{ participant.votes }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}

{% block scripts %}
<script>
    function updateGameData() {
        fetch("{{ url_for('get_game_data') }}")
            .then(response => response.json())
            .then(data => {
                // Runde aktualisieren
                document.getElementById('current-round').textContent = data.round_name;

                // Teilnehmer aktualisieren
                const tbody = document.getElementById('participants-body');
                tbody.innerHTML = '';
                data.participants.forEach(p => {
                    const row = document.createElement('tr');
                    const nameCell = document.createElement('td');
                    const votesCell = document.createElement('td');
                    nameCell.textContent = p.name;
                    votesCell.textContent = p.votes;
                    row.appendChild(nameCell);
                    row.appendChild(votesCell);
                    tbody.appendChild(row);
                });
            })
            .catch(error => console.error('Error fetching game data:', error));
    }
    setInterval(updateGameData, 5000);
</script>
{% endblock %}